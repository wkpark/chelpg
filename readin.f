      SUBROUTINE READIN
C
C       WRITTEN BY M.M. FRANCL FOR THE
C        PRINCETON CHEMISTRY DEPARTMENT VAX 11/780 UNDER VMS 3.4.
C        MODIFIED BY L.E. CHIRLIAN UNDER VMS 3.7.
C
C        MODIFIED FOR GAUSSIAN 86 BY CURT BRENEMAN (VMS 4.5)
C        Modified for G88/90 by Curt Breneman, 2/89
C        YALE UNIVERSITY DEPARTMENT OF CHEMISTRY.
C
C        THIS VERSION IS COMPATIBLE WITH GAUSSIAN 82 FROM CARNEGIE-
C        MELLON UNIVERSITY AND IS DESIGNED FOR THE INPUT OF MO AND
C        BASIS INFORMATION FROM CHECKPOINT FILES.  THIS VERSION IS
C        TO BE USED FOR THE DETERMINATION OF ATOMIC CHARGES FROM
C        ELECTROSTATIC POTENTIALS DETERMINED BY FIRST ORDER HARTREE
C        FOCK PERURBATION THEORY.
C
C        OLD LIMITATIONS:   NO MORE THAN 256 BASIS FUNCTIONS
C                      NO MORE THAN 80 SHELLS
C
C        NEW LIMITATIONS:   NO MORE THAN 1280 BASIS FUNCTIONS
C                      NO MORE THAN 400 SHELLS
C
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER*4 SHELLA,SHELLN,SHELLT,SHELLC,AOS,AON,SHLADF,FILNUM
      CHARACTER*40 CHKFIL
      PARAMETER (NUMPTS = 20)
      DIMENSION LINE(20)
C
      COMMON /IO/ IN,IOUT
c+++
c       Change for G86 : New Commons /MOL/ and /B/
c
      COMMON /MOL/    NATOMS,ICHARG,MULTIP,NAE,NBE,NE,NBASIS,
     $                IAN(401),ATMCHG(400),C(3,400)
C
C===  Gaussian88 Modification.  New Common /b/ size.
      Common/B/EXX(6000),C1(6000),C2(6000),C3(2000),CF(2000),
     $SHLADF(4000),X(2000),Y(2000),
     $Z(2000),JAN(2000),ShellA(2000),ShellN(2000),ShellT(2000),
     $ShellC(2000),AOS(2000),AON(2000),NShell,MaxTyp
C===    Old G86 Common /b/
c      COMMON/B/EXX(1200),C1(1200),C2(1200),C3(400),CF(400),SHLADF(800),
c     $         X(400),Y(400),Z(400),JAN(400),SHELLA(400),SHELLN(400),
c     $         SHELLT(400),SHELLC(400),AOS(400),AON(400),NSHELL,MAXTYP
c
c+++
C%%%
c       Original CHELP common /B/
c
c      COMMON /B/ EXX(240),C1(240),C2(240),C3(80),CF(80),SHLADF(160),
c     $           X(80),Y(80),Z(80),
c     $           JAN(80),SHELLA(80),SHELLN(80),SHELLT(80),SHELLC(80),
c     $           AOS(80),AON(80),NSHELL,MAXTYP
C      COMMON /MOL/ NATOMS,ICHARG,MULTIP,NAE,NBE,NE,NBASIS,IAN(101),
C     $             ATMCHG(100),C(3,100)
C%%%
      COMMON /IPO/ IPO(5)
      COMMON /OUT/ NTITLE(20,3),CHKFIL,Q(400),ND,RMS,PD,
     1             NLIN,NEND(3)
      COMMON /CHARGE/ COEF_ALPHA(100000),COEF_BETA(100000),IUHF
      COMMON /SPHERE/ VDWR(400), NPTS
C        VECT(3,NUMPTS)
C
      DATA MAXBAS /1280/
      DATA MAXPTS/ 50000/
      DATA NPO/ 5/
      DATA IUNIT/ 3/, IREAD/ 2/, IFIND/11/, IBLNK/4H    /
C      DATA VECT/0.00000000,     0.00000000,     1.00000000,
C     $  0.23807485,    -0.08801514,    -0.96725059,
C     $ -0.46055608,     0.17026540,     0.87114740,
C     $  0.65287142,    -0.24136347,    -0.71798508,
C     $ -0.80242446,     0.29665251,     0.51779559,
C     $  0.00000000,     0.00000000,     1.00000000,
C     $ -0.20401674,    -0.15100817,    -0.96725059,
C     $  0.39467063,     0.29212549,     0.87114740,
C     $ -0.55947405,    -0.41410893,    -0.71798508,
C     $  0.68763258,     0.50896872,     0.51779559,
C     $ -0.94978689,    -0.28553486,    -0.12796369,
C     $  0.88757697,     0.26683266,     0.37550960,
C     $ -0.76723180,    -0.23065324,    -0.59846007,
C     $  0.59663385,     0.17936630,     0.78221211,
C     $ -0.38695708,    -0.11633108,    -0.91473018,
C     $  0.28119199,     0.95108168,    -0.12796369,
C     $ -0.26277424,    -0.88878695,     0.37550960,
C     $  0.22714509,     0.76827772,    -0.59846007,
C     $ -0.17663821,    -0.59744720,     0.78221211,
C     $  0.11456173,     0.38748460,    -0.91473018/
C
C       Old "spherical" unit vectors (14 of them)
C
c        0.5773502691896258,0.5773502691896258,
c     $  0.5773502691896258,
c     1 -0.5773502691896258,-0.5773502691896258,0.5773502691896258,
c     2  0.5773502691896258,-0.5773502691896258,-0.5773502691896258,
c     3 -0.5773502691896258,0.5773502691896258,-0.5773502691896258,
c     4  0.0000000000000000E+00,-1.000000000000000,
c     $  0.0000000000000000E+00,
c     5  0.0000000000000000E+00,0.0000000000000000E+00,
c     $  -1.000000000000000,
c     6 -1.000000000000000,0.0000000000000000E+00,
c     $  0.0000000000000000E+00,
c     7 -0.5773502691896258,-0.5773502691896258,-0.5773502691896258,
c     8  1.000000000000000,0.0000000000000000E+00,
c     $  0.0000000000000000E+00,
c     9  0.0000000000000000E+00,1.000000000000000,
c     $  0.0000000000000000E+00,
c     $  0.5773502691896258,0.5773502691896258,-0.5773502691896258,
c     $  0.0000000000000000E+00,0.0000000000000000E+00,
c     $  1.000000000000000,
c     $ -0.5773502691896258,0.5773502691896258,0.5773502691896258,
c     $  0.5773502691896258,-0.5773502691896258,0.5773502691896258,

      IN = 5
      IOUT = 6
C
C        CHECKPOINT FILE NAME
C
      READ(IN,1000) CHKFIL
 1000 FORMAT(A40)
C
C     INPUT INFORMATION
C
 1010 FORMAT(20A4)
      DO 1921 I=1,3
      NLIN= I
      READ (5,1010) LINE
      IF (LINE(1) .EQ. IBLNK) THEN
              NLIN=NLIN-1
              GOTO 192
      END IF
      DO 1922 J=1,20
      L=20-J
      IF (LINE(L) .NE. IBLNK) THEN
              NEND(I) = L
              DO 1923 K=1,NEND(I)
              NTITLE(K,I) = LINE(K)
1923    CONTINUE
      GOTO 1921
      END IF
1922  CONTINUE
1921  CONTINUE
      NLIN=NLIN+1
192   CONTINUE
C
C
C         READ IN PRINT OPTIONS
C
3000  READ(IN,*) (IPO(I),I=1,NPO)
C
C        READ IN # OF D FUNCTIONS
C        NOTE: IF THE BASIS SET USES 5 D FUNCTION, ND MUST BE
C        SET EQUAL TO 1 TO ACCOMODATE THE INTEGRAL PACKAGE.
C        IF THE BASIS SET USES  6 D FUNCTIONS, ND IS SET EQUAL TO
C        0.
C
      READ(IN,*) ND
      IF (ND .NE. 5 .AND. ND .NE. 6) THEN
         STOP '# OF D FUNCTIONS MUST BE 5 OR 6'
      END IF
      IF (ND .EQ. 5) THEN
                      ND = 1
                      GOTO 15
      END IF
      ND = 0
15    CONTINUE
C
C
C        INITIATE FILEIO
C
C***   Different Fopen statement for Trace-7
       CALL FOPEN (IUNIT,5,CHKFIL,IALLOC,junk)
c       CALL FOPEN (IUNIT,'old',CHKFIL(1:linend(chkfil))//char(0))
C
      IWWRIT = IPO(1)
C***********************************************************************
C
C        READ IN COMMON /MOL/
C
c      NWORDS = 1804
c      IFILENO = 30997
c      CALL FILEIO (IREAD,IFILENO,NWORDS,NATOMS,IALLOC)
      IRwMol=997
      MaxAtm=400
      LenMol = 4*MaxAtm + InToWP(8+MaxAtm)
      Call FileIO(2,-FilNum(IRwMol,IUnit),LenMol,NAtoms,0)
C
C***********************************************************************
C
C        READ IN SPHERE DATA (VAN DER WAALS RADII, # OF POINTS TO
C        FIT
C
C
      READ (IN,*)(VDWR(I),I=1,NATOMS)
      READ (IN,*)NPTS
      IF (NPTS .GT. MAXPTS) THEN
         STOP 'MAXIMUM NUMBER OF POINTS MUST BE LESS THAN 50000'
      END IF
C
C        SET MAXIMUM VAN DER WAALS RADII TO 4
C
      VMAX=4.
      DO 20 I=1,NATOMS
      IF (VDWR(I) .GT. VMAX) THEN
            WRITE (IOUT, 2500) I
2500                  FORMAT (3X, 'THE VAN DER WAALS RADII OF ATOM', I3,
     1            'IS OUT OF RANGE')
                  STOP
      END IF
20    CONTINUE
C
      READ (IN,*) VFACT
      DO 21 I=1,NATOMS
      VDWR(I)=VDWR(I)*VFACT
21    CONTINUE
C***********************************************************************
C
C        READ IN BASIS SET INFORMATION (COMMON /B/)
C
      IFILENO = 30506
      CALL FILEIO (IFIND,IFILENO,NWORDS,EXX,0)
      CALL FILEIO (IREAD,-IFILENO,NWORDS,EXX,0)
C***********************************************************************
      IF(IWWRIT .NE. 1) GOTO 170
      WRITE(IOUT,8000)(C(1,I),C(2,I),C(3,I),I=1,NATOMS)
 8000 FORMAT(/1X,'COORDINATES'/(1X,3F12.6))
      WRITE(IOUT,8020) NATOMS,ICHARG,MULTIP,NAE,NBE,NE,NBASIS
     $ ,NSHELL,MAXTYP
 8020 FORMAT(/1X,'NATOMS   = ',I3
     $/1X,'ICHARG = ',I3
     $/1X,'MULTIP = ',I3
     $/1X,'NAE    = ',I3
     $/1X,'NBE    = ',I3
     $/1X,'NE     = ',I3
     $/1X,'NBASIS = ',I3
     $/1X,'NSHELL = ',I3
     $/1X,'MAXTYP = ',I3)
      WRITE(IOUT,8030) (IAN(I),I=1,NATOMS)
 8030 FORMAT(/1X,'IAN'/(1X,20I3))
      WRITE(IOUT,8050) (JAN(I),SHELLT(I),SHELLA(I),I=1,NSHELL)
 8050 FORMAT(/1X,'CENTER TYPE SHELLA'/(1X,3I7))
      WRITE(IOUT,8055) SHELLA(NSHELL+1)
 8055 FORMAT(1X,14X,I7)
      WRITE(IOUT,8060) (EXX(I),C1(I),C2(I),I=1,NSHELL)
 8060 FORMAT(/1X,12X,'EXPON',8X,'EXPCOF(S)',8X,'EXPCOF(P)',
     $/(1X,3E17.9))
      WRITE(IOUT,8070) (C3(I),CF(I),I=1,NSHELL)
 8070 FORMAT(/1X,12X,'EXPCOF(D)',8X,'EXPCOF(F)',
     $/(1X,2E17.9))
      WRITE (IOUT,3575)
3575  FORMAT(/,15X,'ATOM #',5X,'V.D.W. RADII (MULTIPLIED BY FACTOR)')
      DO 3500 I=1,NATOMS
      WRITE (IOUT,4000)I,VDWR(I)
4000  FORMAT (15X,I5,20X,F5.2)
3500  CONTINUE
c      WRITE (IOUT,4500)NPTS
4500  FORMAT(/2X,'NUMBER OF POINTS TO FIT',I6)
  170 CONTINUE
C***********************************************************************
C
C        READ IN ALPHA MO COEFFICIENTS
C
      IFILENO = 30524
      CALL FILEIO (IFIND,-IFILENO,NWORDS,COEF_ALPHA,0)
      CALL FILEIO (IREAD,-IFILENO,NWORDS,COEF_ALPHA,0)
C***********************************************************************
C
C        READ IN THE BETA MO COEFFICIENTS
C
      IFILENO = 30526
      CALL FILEIO (IFIND,IFILENO,NWORDS,COEF_BETA,0)
      IF (NWORDS.EQ.0) THEN
      IUHF = 0
      GOTO 300
      END IF
      IUHF = 1
      CALL FILEIO (IREAD,-IFILENO,NWORDS,COEF_BETA,0)
C***********************************************************************
  300 CONTINUE
C***********************************************************************
      RETURN
      END
